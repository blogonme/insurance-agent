# 咖啡 ERP 系统问题日志 (ISSUES_LOG)

| ID           | 模块        | 严重程度     | 问题描述                                                                   | 修复建议                                                  | 状态   |
| :----------- | :---------- | :----------- | :------------------------------------------------------------------------- | :-------------------------------------------------------- | :----- |
| **MT-001**   | 安全/多租户 | **CRITICAL** | `users` 表 `username` 字段为全局 `UNIQUE`，导致跨账套无法重名。            | 修改约束为 `UNIQUE(ledger_set_id, username)`。            | 已完成 |
| **TEST-001** | 测试        | **CRITICAL** | 完全缺失单元测试和集成测试目录。                                           | 建立 `src/test` 目录，针对核心 Service 建立测试类。       | 待处理 |
| **FE-001**   | 前端        | **MAJOR**    | `SalesOrders.tsx` 组件重构：完成子组件拆分、Hooks 抽象及信用检查逻辑集成。 | 页面组件化重构已完成 (2026-01-07)。                       | 已完成 |
| **TS-001**   | 前端        | **MAJOR**    | 滥用 `any` 类型 (208 处)，削弱了 TypeScript 的价值。                       | 建立共享的 `types.ts` 定义接口，逐步替换 `any`。          | 待处理 |
| **DB-001**   | 数据库/架构 | **MAJOR**    | `org_id` 与 `ledger_set_id` 字段并存，旧字段清理不彻底。                   | 制定全字段迁移计划，统一定义为 `ledger_id`。              | 待处理 |
| **ARCH-001** | 后端        | **MINOR**    | Controller 与 Service 数量不匹配，部分业务逻辑残留在 Controller 层。       | 重构 `ItemCategoryController` 等，建立专门的 Service 层。 | 待处理 |
| **SEC-001**  | 安全        | **MINOR**    | 敏感配置（gcp.yml）可能存在硬编码风险。                                    | 使用环境变量或配置中心管理敏感信息。                      | 待处理 |
| **DOC-001**  | 文档        | **MINOR**    | TODO/FIXME 注释较多未清理。                                                | 扫描并分类 TODO，建立开发计划。                           | 待处理 |
